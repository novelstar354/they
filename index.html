<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>全言語翻訳機（Single-file HTML）</title>
  <style>
    :root{--bg:#0b1220;--card:#0f1724;--muted:#9aa4b2;--accent:#7dd3fc}
    *{box-sizing:border-box}
    body{margin:0;font-family:Inter,ui-sans-serif,system-ui,Segoe UI,Roboto,"Hiragino Kaku Gothic ProN",Meiryo,sans-serif;background:linear-gradient(180deg,#041026 0%,#071327 100%);color:#e6eef6;min-height:100vh;display:flex;align-items:center;justify-content:center;padding:24px}
    .app{width:100%;max-width:980px}
    header{display:flex;align-items:center;justify-content:space-between;margin-bottom:18px}
    h1{font-size:20px;margin:0}
    .card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));padding:18px;border-radius:12px;box-shadow:0 6px 24px rgba(2,6,23,0.6)}
    .row{display:flex;gap:12px}
    textarea{width:100%;min-height:160px;padding:12px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit;font-size:16px}
    select,input,button{padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:#fff}
option{color:#000}
    .controls{display:flex;gap:8px;align-items:center;margin-top:12px}
    .flex{flex:1}
    .small{font-size:13px;color:var(--muted)}
       footer {
           padding: 30px;
           text-align: center;
           font-size: 0.85rem;
           color: rgba(255,255,255,0.5);
           border-top: 1px solid rgba(255,255,255,0.1);
           margin-top: 60px;
       }
    .actions{display:flex;gap:8px}
    .btn-primary{background:linear-gradient(90deg,var(--accent),#60a5fa);color:#042532;border:none;cursor:pointer}
    .btn-ghost{background:transparent;border:1px solid rgba(255,255,255,0.04);cursor:pointer}
    .status{margin-top:10px;font-size:13px;color:var(--muted)}
    .split{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    @media(max-width:740px){.split{grid-template-columns:1fr}}
    .provider{font-size:13px}
    .note{margin-top:8px;color:#9fb6c9;font-size:13px}
  </style>
</head>
<body>
  <div class="app">
    <header>
      <h1>全言語翻訳機 — Single-file HTML</h1>
      <div class="small">オフライン版ではありません。API（LibreTranslate / Google 非公式）を使います。</div>
    </header>

    <main class="card">
      <div class="split">
        <div>
          <label class="small">入力テキスト</label>
          <textarea id="input" placeholder="ここに翻訳したい文章を入れてください。複数行可。例: こんにちは、世界！"></textarea>

          <div class="controls">
            <select id="sourceLang" class="flex">
              <option value="auto">自動検出（auto）</option>
            </select>
            <select id="targetLang" style="width:220px">
            </select>
            <div class="actions">
              <button id="swapBtn" class="btn-ghost">入出力入替</button>
              <button id="translateBtn" class="btn-primary">翻訳</button>
            </div>
          </div>

          <div class="controls">
            <label class="provider">プロバイダー:
              <select id="provider">
                <option value="libre">LibreTranslate（推奨：CORS対応インスタンス）</option>
                <option value="google">Google 非公式（動作しない場合あり）</option>
              </select>
            </label>
            <input id="apiKey" placeholder="LibreTranslate API Key（必要なら）" style="flex:1" />
          </div>

          <div class="note">注意: 一部の翻訳APIはCORS制限があります。ブラウザで直接使えない場合は、ローカルでプロキシを立てるか、CORS対応のLibreTranslateインスタンスを使用してください。</div>
        </div>

        <div>
          <label class="small">翻訳結果</label>
          <textarea id="output" readonly placeholder="翻訳結果がここに表示されます"></textarea>

          <div class="controls" style="margin-top:8px">
            <button id="copyBtn" class="btn-ghost">コピー</button>
            <button id="downloadBtn" class="btn-ghost">結果をダウンロード (.txt)</button>
            <button id="speakBtn" class="btn-ghost">読み上げ</button>
            <div style="flex:1"></div>
            <div id="status" class="status">準備完了</div>
          </div>

          <div style="margin-top:10px">
            <label class="small">オプション</label>
            <div style="display:flex;gap:8px;margin-top:6px">
              <label class="small"><input type="checkbox" id="preserveNewlines" checked /> 改行を保持</label>
              <label class="small"><input type="checkbox" id="autoSpeak" /> 翻訳後自動読み上げ</label>
            </div>
          </div>
        </div>
      </div>

      <footer>
        <div>使い方: テキストを入れて、ターゲット言語を選び「翻訳」を押します。プロバイダーとAPIキーは必要に応じて設定してください。</div>
      </footer>
    </main>
  </div>
     <footer>
       © 2025 STAR TOOLS - All Rights Reserved.
   </footer>


<script>
// --- 言語リスト（LibreTranslate 互換）
const fallbackLangs = [
  {code:'ar',name:'Arabic'},
  {code:'zh',name:'Chinese'},
  {code:'cs',name:'Czech'},
  {code:'da',name:'Danish'},
  {code:'nl',name:'Dutch'},
  {code:'en',name:'English'},
  {code:'fi',name:'Finnish'},
  {code:'fr',name:'French'},
  {code:'de',name:'German'},
  {code:'hi',name:'Hindi'},
  {code:'hu',name:'Hungarian'},
  {code:'id',name:'Indonesian'},
  {code:'ga',name:'Irish'},
  {code:'it',name:'Italian'},
  {code:'ja',name:'Japanese'},
  {code:'ko',name:'Korean'},
  {code:'pl',name:'Polish'},
  {code:'pt',name:'Portuguese'},
  {code:'ru',name:'Russian'},
  {code:'es',name:'Spanish'},
  {code:'sv',name:'Swedish'},
  {code:'tr',name:'Turkish'}
];

const src = document.getElementById('sourceLang');
const tgt = document.getElementById('targetLang');
const input = document.getElementById('input');
const output = document.getElementById('output');
const translateBtn = document.getElementById('translateBtn');
const status = document.getElementById('status');
const providerSel = document.getElementById('provider');
const apiKeyInput = document.getElementById('apiKey');
const copyBtn = document.getElementById('copyBtn');
const downloadBtn = document.getElementById('downloadBtn');
const speakBtn = document.getElementById('speakBtn');
const swapBtn = document.getElementById('swapBtn');

function setStatus(t){status.textContent = t}

async function loadLanguages(){
  setStatus('言語リストを取得中...');
  // try LibreTranslate public instance
  const instance = 'https://libretranslate.com';
  try{
    const res = await fetch(instance + '/languages');
    if(!res.ok) throw new Error('failed');
    const data = await res.json();
    populateLangs(data);
    setStatus('言語リスト取得完了 ('+instance+')');
    return;
  }catch(e){
    // fallback to hardcoded
    populateLangs(fallbackLangs);
    setStatus('言語リストはフォールバックを使用（ネット接続またはCORSの問題）');
  }
}

function populateLangs(list){
  // clear
  src.innerHTML = '<option value="auto">自動検出（auto）</option>';
  tgt.innerHTML = '';
  list.forEach(l => {
    const code = l.code || l.language || l.iso639;
    const name = l.name || l.language || code;
    const opt1 = document.createElement('option'); opt1.value = code; opt1.textContent = name + ' ('+code+')';
    const opt2 = opt1.cloneNode(true);
    src.appendChild(opt1);
    tgt.appendChild(opt2);
  });
  // default target to Japanese if exists
  const jp = Array.from(tgt.options).find(o => o.value === 'ja');
  if(jp) jp.selected = true;
}

async function translate(){
  const text = input.value.trim();
  if(!text){setStatus('入力が空です');return}
  const source = src.value; const target = tgt.value;
  setStatus('翻訳中...');
  translateBtn.disabled = true;

  try{
    const provider = providerSel.value;
    let translated = '';
    if(provider === 'libre'){
      translated = await translateLibre(text, source, target);
    }else{
      translated = await translateGoogleUnofficial(text, source, target);
    }
    output.value = translated;
    setStatus('翻訳完了');
    if(document.getElementById('autoSpeak').checked){speak(translated)}
  }catch(err){
    console.error(err);
    setStatus('翻訳に失敗しました: '+err.message);
    alert('翻訳に失敗しました。CORS制限やAPI制限の可能性があります。コンソールを確認してください。')
  }finally{ translateBtn.disabled = false }
}

async function translateLibre(text, source, target){
  // Use user-specified instance? For simplicity, call libretranslate.com
  const instance = 'https://libretranslate.com';
  const url = instance + '/translate';
  const body = {q:text, source: source === 'auto' ? 'auto' : source, target: target};
  const headers = {'Content-Type':'application/json'};
  const key = apiKeyInput.value.trim();
  if(key) body.api_key = key;
  const res = await fetch(url, {method:'POST',headers,body:JSON.stringify(body)});
  if(!res.ok) throw new Error('LibreTranslate error: '+res.status);
  const j = await res.json();
  // LibreTranslate returns {translatedText: '...'}
  return j.translatedText || j.result || '';
}

async function translateGoogleUnofficial(text, source, target){
  // Unofficial endpoint used by many clients. May break or be CORS-blocked.
  // This endpoint returns a complex array — we extract text pieces.
  const sl = source === 'auto' ? 'auto' : source;
  const url = 'https://translate.googleapis.com/translate_a/single?client=gtx&sl=' + encodeURIComponent(sl) + '&tl=' + encodeURIComponent(target) + '&dt=t&q=' + encodeURIComponent(text);
  const res = await fetch(url);
  if(!res.ok) throw new Error('Google unofficial error: '+res.status);
  const j = await res.json();
  // flatten
  let out = '';
  if(Array.isArray(j)){
    j[0].forEach(part => { if(Array.isArray(part)) out += (part[0]||''); });
  }
  return out;
}

copyBtn.addEventListener('click', ()=>{
  output.select(); navigator.clipboard.writeText(output.value).then(()=>setStatus('コピーしました'));
});

downloadBtn.addEventListener('click', ()=>{
  const blob = new Blob([output.value],{type:'text/plain'});
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = 'translation.txt';
  document.body.appendChild(a); a.click(); a.remove();
});

speakBtn.addEventListener('click', ()=>{speak(output.value)});

function speak(text){
  if(!text) return setStatus('読み上げするテキストがありません');
  if(!('speechSynthesis' in window)){return alert('ブラウザはSpeechSynthesisをサポートしていません');}
  const utter = new SpeechSynthesisUtterance(text);
  // try to set lang based on target selection
  utter.lang = tgt.value || 'ja';
  speechSynthesis.cancel();
  speechSynthesis.speak(utter);
}

swapBtn.addEventListener('click', ()=>{
  const t = input.value; input.value = output.value || '';
  output.value = t || '';
});

translateBtn.addEventListener('click', translate);

// load
loadLanguages();

// handy: Ctrl+Enter to translate
input.addEventListener('keydown', (e)=>{ if(e.ctrlKey && e.key === 'Enter') translate(); });

// Provide quick presets: detect available voices and set default language for speak
window.addEventListener('load', ()=>{
  try{ const v = speechSynthesis.getVoices(); }catch(e){}
});

</script>
</body>
</html>
